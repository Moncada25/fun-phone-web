---
const screenshots = [
  { src: import.meta.env.BASE_URL + 'assets/screenshots/contacts.png', alt: 'Fun Phone – Contacts view' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/details.png', alt: 'Fun Phone – Contact details' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/dialer.png', alt: 'Fun Phone – Smart dialer' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/extras.png', alt: 'Fun Phone – Extras hub' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/favorites.png', alt: 'Fun Phone – Favorites tab' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/history.png', alt: 'Fun Phone – Call history' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/qr.png', alt: 'Fun Phone – QR sharing' },
  { src: import.meta.env.BASE_URL + 'assets/screenshots/settings.png', alt: 'Fun Phone – Settings screen' }
];
const carouselData = JSON.stringify(screenshots);
---
<div
  class="relative mx-auto w-full max-w-3xl"
  x-data={`screenshotCarousel({ screenshots: ${carouselData} })`}
  x-init="init()"
  role="region"
  aria-roledescription="carousel"
  x-bind:aria-label="label"
>
  <div class="mb-4 flex items-center justify-between">
    <p class="text-sm font-semibold uppercase tracking-wide text-accent" x-show="lang==='es'">Vista previa de la app</p>
    <p class="text-sm font-semibold uppercase tracking-wide text-accent" x-show="lang==='en'">In-app preview</p>
    <div class="hidden items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400 md:flex">
      <span x-text="currentSlide"></span>
      <span>/</span>
      <span x-text="screens.length"></span>
    </div>
  </div>
  <div
    class="relative overflow-hidden rounded-3xl border border-neutral-200 bg-gradient-to-br from-neutral-50 via-white to-neutral-100 shadow-xl dark:border-neutral-800 dark:from-neutral-900 dark:via-neutral-900 dark:to-neutral-950"
    @mouseenter="stopAutoPlay()"
    @mouseleave="startAutoPlay()"
  >
    <img
      x-ref="image"
      x-bind:src="screens[currentIndex].src"
      x-bind:alt="screens[currentIndex].alt"
      class="mx-auto w-auto max-h-[420px] rounded-2xl object-contain transition duration-500 ease-out"
      loading="lazy"
    />
    <button
      type="button"
      class="absolute left-4 top-1/2 -translate-y-1/2 rounded-full border border-neutral-200 bg-white/80 p-3 text-neutral-800 shadow-lg backdrop-blur transition hover:border-accent hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent dark:border-neutral-700 dark:bg-neutral-900/80 dark:text-neutral-200"
      @click="previous()"
      aria-label="Anterior"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
    </button>
    <button
      type="button"
      class="absolute right-4 top-1/2 -translate-y-1/2 rounded-full border border-neutral-200 bg-white/80 p-3 text-neutral-800 shadow-lg backdrop-blur transition hover:border-accent hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent dark:border-neutral-700 dark:bg-neutral-900/80 dark:text-neutral-200"
      @click="next()"
      aria-label="Siguiente"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
    </button>
  </div>
  <div class="mt-4 flex flex-wrap items-center justify-center gap-2" role="tablist" aria-label="Miniaturas de la galería">
    {screenshots.map((shot, idx) => (
      <button
        type="button"
        class="h-12 w-20 overflow-hidden rounded-xl border border-transparent bg-neutral-100 transition hover:border-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent dark:bg-neutral-800"
        role="tab"
        data-index={idx}
        x-bind:data-active="currentIndex === Number($el.dataset.index)"
        x-bind:aria-selected="(currentIndex === Number($el.dataset.index)).toString()"
        x-bind:aria-label="thumbLabel(Number($el.dataset.index))"
        @click="goTo(Number($el.dataset.index))"
      >
        <img src={shot.src} alt={shot.alt} class="h-full w-full object-cover" loading="lazy" />
      </button>
    ))}
  </div>
</div>

<script is:inline>
function screenshotCarousel({ screenshots }) {
  return {
    screens: screenshots,
    currentIndex: 0,
    get currentSlide() {
      return this.currentIndex + 1;
    },
    label: 'Fun Phone screenshots carousel',
    autoPlayTimer: null,
    prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches,
    init() {
      this.startAutoPlay();
      this.bindKeyboard();
    },
    startAutoPlay() {
      if (this.prefersReducedMotion || this.autoPlayTimer) return;
      this.autoPlayTimer = setInterval(() => this.next(), 5000);
    },
    stopAutoPlay() {
      if (!this.autoPlayTimer) return;
      clearInterval(this.autoPlayTimer);
      this.autoPlayTimer = null;
    },
    next() {
      this.stopAutoPlay();
      this.currentIndex = (this.currentIndex + 1) % this.screens.length;
      this.startAutoPlay();
    },
    previous() {
      this.stopAutoPlay();
      this.currentIndex = (this.currentIndex - 1 + this.screens.length) % this.screens.length;
      this.startAutoPlay();
    },
    goTo(index) {
      this.stopAutoPlay();
      this.currentIndex = index;
      this.startAutoPlay();
    },
    thumbLabel(index) {
      return `${index + 1} / ${this.screens.length}`;
    },
    bindKeyboard() {
      window.addEventListener('keydown', (event) => {
        if (event.key === 'ArrowRight') {
          event.preventDefault();
          this.next();
        } else if (event.key === 'ArrowLeft') {
          event.preventDefault();
          this.previous();
        }
      });
    }
  };
}
</script>
